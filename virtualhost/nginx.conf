# ==========================================================
# 1. Pi-hole Server Configuration
# ==========================================================
server {
    # Listen for incoming HTTP traffic on the standard port 80
    listen 80;

    # The domain name this block responds to. 
    # DNS must point 'ph.lin' to this Nginx server's IP.
    server_name ph.lin;

    location / {
        # Forwards all traffic to the internal pihole-server on port 8001.
        # The trailing slash ensures the URI is passed correctly.
        proxy_pass http://pihole-server:8001/;
        
        # --- Standard Proxy Headers ---
        
        # Passes the original 'Host' header (ph.lin) to the backend
        proxy_set_header Host $host;

        # Sends the actual client's IP address to the backend
        proxy_set_header X-Real-IP $remote_addr;

        # Appends the client's IP to a list of IPs the request has passed through
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # Tells the backend whether the client used HTTP or HTTPS
        proxy_set_header X-Forwarded-Proto $scheme;

        # --- Specific Adjustments ---

        # Removes the 'X-Frame-Options' header sent by the backend.
        # Often needed if you plan to embed the Pi-hole UI in an iframe.
        proxy_hide_header X-Frame-Options;

        # A custom header sometimes used by Pi-hole setups to recognize the proxy host
        proxy_set_header X-Pi-hole-Host $host;
    }
}

# ==========================================================
# 2. Wlingo Server Configuration
# ==========================================================
server {
    listen 80;
    server_name wlingo.lin;

    location / {
        # Forwards traffic to the wlingo application container on port 8002
        proxy_pass http://wlingo-server:8002/;

        # Re-using the same header logic to ensure the application knows:
        # 1. Who the user is (IP)
        # 2. What URL they typed in their browser (Host)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Note: You likely don't need 'X-Pi-hole-Host' for Wlingo unless 
        # it shares Pi-hole's codebase, but it won't hurt to keep.
        proxy_hide_header X-Frame-Options;
        proxy_set_header X-Pi-hole-Host $host;
    }
}


# ==========================================================
# 3. pgAdmin Server Configuration
# ==========================================================
server {
    listen 80;
    server_name pgadmin.lin;

    location / {
        # Forwards traffic to the wlingo application container on port 8002
        proxy_pass http://pgadmin-server:5050/;

        # Re-using the same header logic to ensure the application knows:
        # 1. Who the user is (IP)
        # 2. What URL they typed in their browser (Host)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Note: You likely don't need 'X-Pi-hole-Host' for Wlingo unless 
        # it shares Pi-hole's codebase, but it won't hurt to keep.
        proxy_hide_header X-Frame-Options;
        proxy_set_header X-Pi-hole-Host $host;
    }
}